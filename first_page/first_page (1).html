<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
	</head>
<body>
</body>

<title>Web GIS</title>
	 <!-- Import OpenLayers, reduced, wms read only version -->
<script src="http://localhost:8081/test/libs/OpenLayers-2.13.1/OpenLayers.js" type="text/javascript"></script>
<link rel="stylesheet" href="http://localhost:8081/test/libs/OpenLayers-2.13.1/theme/default/style.css" type="text/css">
<link rel="stylesheet" href="http://localhost:8081/test/libs/OpenLayers-2.13.1/theme/default/style.css" type="text/css" />

<!-- ExtJS -->
<script type="text/javascript" src="http://localhost:8081/test/libs/ext-4.2.1.883/examples/shared/include-ext.js"></script>
<script type="text/javascript" src="http://localhost:8081/test/libs/ext-4.2.1.883/examples/shared/options-toolbar.js"></script>

<!-- Shared -->
<link rel="stylesheet" type="text/css" href="http://localhost:8081/test/libs/ext-4.2.1.883/examples/shared/example.css"/>
	 


<script type="text/javascript">
var popup;
Ext.Loader.setConfig({
    enabled: true,
    disableCaching: false,
    paths: {
        GeoExt: "http://localhost:8081/test/libs/geoext2-2.1.0/src/GeoExt"
    }
});

Ext.require([
   
    'GeoExt.tree.OverlayLayerContainer',
    'GeoExt.tree.BaseLayerContainer',
    'GeoExt.data.LayerTreeModel',
	 'GeoExt.Action'
   
]);


   Ext.onReady(function() {
   	
   Ext.QuickTips.init();

    	var bounds = new OpenLayers.Bounds(
                    68.1862489922762, 6.75556607519684,
                    97.4152926679075, 37.0766772569498
                );
		 
	var options = {
				  maxExtent: bounds,
                   // maxResolution:  0.222,
                    projection: "EPSG:4326",
					allOverlays: true,
                    units: 'degrees',
					//center: new OpenLayers.LonLat(23,77),
					zoom: 5,
					//controls:[new OpenLayers.Control.MouseDefaults()]											
                };
				
				
				var map = new OpenLayers.Map('map', options);
				
				var india_state = new OpenLayers.Layer.WMS(
                    "india_state", "http://localhost:8081/geoserver/wms",
                    {
                        LAYERS: 'spatial:india_state',
                        STYLES: '',
                        format: 'image/png',
						tiled: true,
						transparent: true
                      //  tilesOrigin : map.maxExtent.left + ',' + map.maxExtent.bottom
                    },
					{
				//	tileOptions: {maxGetUrlLength: 2048},
					displayInLayerSwitcher: true,
					isBaseLayer: false,
					//singleTile: true,
					transitionEffect: 'resize'
					}
                );
				
				var india_dist = new OpenLayers.Layer.WMS(
                    "india_district", "http://localhost:8081/geoserver/wms",
                    {
                        LAYERS: 'spatial:India_district',
                        STYLES: '',
                        format: 'image/png',
						//cql_filter: 'state_name == "BIHAR"',
                       tiled: true,
						transparent: true
                      //  tilesOrigin : map.maxExtent.left + ',' + map.maxExtent.bottom
                    },
					{
				//	tileOptions: {maxGetUrlLength: 2048},
					displayInLayerSwitcher: true,
					isBaseLayer: false,
					//singleTile: true,
					transitionEffect: 'resize'
					}
                );
				
			map.addLayers([india_state,india_dist]);
			
			//pan map
			
			var pan = Ext.create('GeoExt.Action',{
		         tooltip: "Pan Map",
           // iconCls: "icon-pan",
		   text: "Pan Map",
			icon:"http://localhost:8081/test/tools_png/pan.png",
            enableToggle: true,
            pressed: false,
            allowDepress: true,
            control: new OpenLayers.Control.Navigation(),
            map: map,
            toggleGroup: 'tools'
                });
				
			var pan_map = Ext.create('Ext.Button', pan);
			
			var zoomin = Ext.create('Ext.Button',{
                handler: function(){
                    map.zoomIn();
                },
                tooltip: "Zoom In",
                icon: "http://localhost:8081/test/tools_png/magnifier_zoom_in.png",
				text: "Zoom In",
               // toggleGroup: 'tools',
				//allowDepress: false,
				//enableToggle: true,
            });

			
			//zoom out
         var zoomout = Ext.create('Ext.Button',{
                handler: function(){
                    map.zoomOut();
                },
                tooltip: "Zoom In",
                icon: "http://localhost:8081/test/tools_png/magnifier_zoom_out.png",
				text: "Zoom Out"
				//text: "zoom in",
                //toggleGroup: 'tools',
				//allowDepress: false,
				//enableToggle: true,
            });
			
			var zoomex = Ext.create('GeoExt.Action',{
                    icon:"http://localhost:8081/test/tools_png/arrow_out.png",
                    control: new OpenLayers.Control.ZoomToMaxExtent(),
                    map: map,
                    text: "max extent",
					//toggleGroup: 'tools',  // only one tool can be active in a group
                    tooltip: "zoom to full extent",
					//enableToggle: true,
                    pressed: false,
                    allowDepress: false,
                });
				var zoom_ex = Ext.create('Ext.Button', zoomex);
				
		// rectangle zoom		
				var zoomrec = Ext.create('GeoExt.Action',{
		           // height: 40,
                  //  width: 	40,				
                    icon:"http://localhost:8081/test/tools_png/magnifier.png",
					text: "Zoom Rectangle",
					control: new OpenLayers.Control.ZoomBox(),
					map: map,
					toggleGroup: 'tools',  // only one tool can be active in a group
                    allowDepress: true,
                    pressed: false,
					enableToggle: true,
            
            //allowDepress: false,
                    tooltip: "zoom"
                });
			var zoom_rec = Ext.create('Ext.Button', zoomrec);
			
			// previous and next zoom		
		var historyControl = new OpenLayers.Control.NavigationHistory();
        map.addControl(historyControl);
		
		var navPreviousAction = Ext.create('GeoExt.Action',{
            tooltip: "Zoom to Previous Extent",
            icon:"http://localhost:8081/test/tools_png/arrow_left.png",
			text:"zoom prev",
            disabled: true,
			enableToggle: true,
            pressed: false,
            allowDepress: false,
            control: historyControl.previous,
			toggleGroup: 'tools'
        });
        var nav_prev = Ext.create('Ext.Button', navPreviousAction);
		
        var navNextAction = Ext.create('GeoExt.Action',{
            tooltip: "Zoom to Next Extent",
            icon:"http://localhost:8081/test/tools_png/arrow_right.png",
			text:"zoom next",
            disabled: true,
			enableToggle: true,
            pressed: false,
            allowDepress: false,
            control: historyControl.next,
			toggleGroup: 'tools'
        });

		var nav_nxt = Ext.create('Ext.Button', navNextAction);
		
		//measure length
		 var measure_len = Ext.create('GeoExt.Action',{
                   icon:"http://localhost:8081/test/tools_png/length.png",
                    text: "Measure Length",
                   control: new OpenLayers.Control.Measure(OpenLayers.Handler.Path, {
                        geodesic: true,
                        eventListeners: {
                            measure: function(event) {
                              if (event.order == 1) {
                                var win = new Ext.Window({
                                    title: "Measure Results",
                                    modal: true,
                                    width: 180,
                                    constrain: true,
                                    bodyStyle: {padding: 10},
                                    html: event.measure.toFixed(3) + " " + event.units
                                });
                                win.show();}
								else{
                                var win = new Ext.Window({
                                    title: "Measure Results",
                                    modal: true,
                                    width: 180,
                                    constrain: true,
                                    bodyStyle: {padding: 10},
                                    html: event.measure.toFixed(3) + " " + event.units + "<sup>2</" + "sup>"
                                });
                                win.show();}
                            }
                        }
                    }),
                    map: map,
                    // button options
                    toggleGroup: 'tools',  // only one tool can be active in a group
                    allowDepress: true,
                    tooltip: "measure distance"
                });
		
var m_len = Ext.create('Ext.Button', measure_len);
		
			// measure area	
	var measure_area = Ext.create('GeoExt.Action',{
	               icon:"http://localhost:8081/test/tools_png/area.png",
                    text: "Measure Area",
                   control: new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon, {
                        geodesic: true,
                        eventListeners: {
                            measure: function(event) {
							if (event.order == 1) {
                                var win = new Ext.Window({
                                    title: "Measure Results",
                                    modal: true,
                                    width: 180,
                                    constrain: true,
                                    bodyStyle: {padding: 10},
                                    html: event.measure.toFixed(3) + " " + event.units
                                });
                                win.show();}
								else{
                                var win = new Ext.Window({
                                    title: "Measure Results",
                                    modal: true,
                                    width: 180,
                                    constrain: true,
                                    bodyStyle: {padding: 10},
                                    html: event.measure.toFixed(3) + " " + event.units + "<sup>2</" + "sup>"
                                });
                                win.show();}
                            }
                        }
                    }),
                    map: map,
                    // button options
                    toggleGroup: 'tools',  // only one tool can be active in a group
                    allowDepress: true,
                    tooltip: "measure area"
                });
	var m_area = Ext.create('Ext.Button', measure_area);
	
	//get feature info			 
		var info = Ext.create('GeoExt.Action',{
            tooltip: "Feature Info",
			icon:"http://localhost:8081/test/tools_png/info.png",
			text: "GetInfo",
           // iconCls: "icon-pan",
		 //  text: "Information",
			//icon:"pan.png",
            enableToggle: true,
            //pressed: true,
            allowDepress: true,
            control: new OpenLayers.Control.WMSGetFeatureInfo({
    //autoActivate: true,
          url: "http://localhost:8081/geoserver/wms",
           title: 'Identify features by clicking',
            queryVisible: true,
            eventListeners: {
                getfeatureinfo: function(event) {
				
				if(popup) {map.removePopup(popup);}
				
                        popup = new OpenLayers.Popup.FramedCloud(
                        "chicken", 
                        map.getLonLatFromPixel(event.xy),
                        null,
                        event.text,
                        null,
                        true
                    );
					
					map.addPopup(popup);
                }
            }
}),
            map: map,
            toggleGroup: 'tools'
        });
		
		var get_info = Ext.create('Ext.Button', info);

 var mapPanel = Ext.create('GeoExt.panel.Map', {
           // title: 'Mappanel',
            map: map,
			region: 'center',
			stateful: true,
           // stateId: 'mappanel',
		   tbar: [pan_map, zoomin, zoomout, zoom_ex, zoom_rec, nav_prev, nav_nxt, m_len, m_area, get_info],
            dockedItems: [{
                xtype: 'toolbar',
                dock: 'top',
                items: []
            }]
        });			
	
var store = Ext.create('Ext.data.TreeStore', {
            model: 'GeoExt.data.LayerTreeModel',
            root: {
                expanded: true,
                children: [
                    {
                        plugins: [{
                            ptype: 'gx_layercontainer',
                            store: mapPanel.layers
                        }],
                        expanded: true
                    }, {
                        plugins: ['gx_baselayercontainer'],
                        expanded: true,
                        text: "Base Maps"
                    }, {
                        plugins: ['gx_overlaylayercontainer'],
                        expanded: true
                    }
                ]
            }
        });
      //  var layer;
		  var tree = Ext.create('GeoExt.tree.Panel', {
            border: true,
            region: "west",
            title: "Layers",
            width: 250,
            split: true,
            collapsible: true,
           // collapseMode: "mini",
            autoScroll: true,
            store: store,
            rootVisible: false,
            lines: false,
        });
		
		var north = Ext.create('Ext.panel.Panel', {
			    title: "<center>My First Web GIS page</center>",
         	    region: 'north',
		        });
	 
var viewport = Ext.create('Ext.Viewport', {
            layout: "fit",
            hideBorders: true,
            items: {
                layout: "border",
                deferredRender: false,
                items: [mapPanel, north, tree]
            }
        });

	
});




</script>
</html>
